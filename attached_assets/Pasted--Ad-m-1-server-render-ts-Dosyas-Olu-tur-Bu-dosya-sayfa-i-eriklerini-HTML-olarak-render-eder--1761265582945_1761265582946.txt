
ğŸ“ AdÄ±m 1: server/render.ts DosyasÄ± OluÅŸtur
Bu dosya sayfa iÃ§eriklerini HTML olarak render eder:

import { storage } from "./storage";
interface RenderResult {
  html: string;
  statusCode: number;
}
// Ana Sayfa SSR
export async function renderHomePage(): Promise<RenderResult> {
  try {
    // VeritabanÄ±ndan gerekli verileri Ã§ek
    const data = await storage.getHomeData(); // Kendi metodunu kullan
    
    const html = `
      <div class="container mx-auto px-4 py-8">
        <article>
          <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold mb-4">Ana Sayfa BaÅŸlÄ±ÄŸÄ±</h1>
            <p class="text-xl text-muted-foreground">
              AÃ§Ä±klama metni buraya gelecek
            </p>
          </header>
          
          <section>
            <h2 class="text-3xl font-semibold mb-6">Ä°Ã§erik BÃ¶lÃ¼mÃ¼</h2>
            <!-- Dinamik iÃ§erik -->
          </section>
        </article>
      </div>
    `;
    
    return { html, statusCode: 200 };
  } catch (error) {
    console.error("Home SSR error:", error);
    return {
      html: '<div class="container"><p>Bir hata oluÅŸtu</p></div>',
      statusCode: 500,
    };
  }
}
// Detay SayfasÄ± SSR (Ã¶rnek: /:slug)
export async function renderDetailPage(slug: string): Promise<RenderResult> {
  try {
    const item = await storage.getItemBySlug(slug); // Kendi metodunu kullan
    
    if (!item) {
      return {
        html: '<div class="container"><h1>Sayfa BulunamadÄ±</h1></div>',
        statusCode: 404,
      };
    }
    
    const html = `
      <div class="container mx-auto px-4 py-8">
        <article>
          <header class="mb-8">
            <h1 class="text-4xl font-bold mb-4">${item.title}</h1>
            <p class="text-lg text-muted-foreground">
              ${item.description}
            </p>
          </header>
          
          <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Ä°Ã§erik</h2>
            <div class="prose max-w-none">
              ${item.content}
            </div>
          </section>
        </article>
      </div>
    `;
    
    return { html, statusCode: 200 };
  } catch (error) {
    console.error("Detail SSR error:", error);
    return {
      html: '<div class="container"><p>Bir hata oluÅŸtu</p></div>',
      statusCode: 500,
    };
  }
}
ğŸ“ AdÄ±m 2: server/ssr.ts DosyasÄ± OluÅŸtur
Bu dosya meta tag'leri ve SSR'Ä± yÃ¶netir:

import { type Request, type Response } from "express";
import { storage } from "./storage";
import fs from "fs";
import {
  renderHomePage,
  renderDetailPage,
} from "./render";
interface PageMeta {
  title: string;
  description: string;
  canonicalUrl: string;
  ogTitle: string;
  ogDescription: string;
  statusCode: number;
}
// URL'e gÃ¶re meta tag'leri oluÅŸtur
export async function generatePageMeta(url: string): Promise<PageMeta> {
  const baseUrl = process.env.BASE_URL || "https://yoursite.com";
  const canonicalUrl = `${baseUrl}${url}`;
  
  try {
    // Ana sayfa
    if (url === "/" || url === "") {
      return {
        title: "Ana Sayfa - Site AdÄ±",
        description: "Site aÃ§Ä±klamasÄ± buraya gelecek",
        canonicalUrl: baseUrl,
        ogTitle: "Ana Sayfa",
        ogDescription: "Site aÃ§Ä±klamasÄ±",
        statusCode: 200,
      };
    }
    
    // Detay sayfasÄ±: /:slug
    const parts = url.split("/").filter(Boolean);
    if (parts.length === 1) {
      const slug = parts[0];
      const item = await storage.getItemBySlug(slug);
      
      if (!item) {
        return {
          title: "Sayfa BulunamadÄ±",
          description: "AradÄ±ÄŸÄ±nÄ±z sayfa bulunamadÄ±",
          canonicalUrl,
          ogTitle: "Sayfa BulunamadÄ±",
          ogDescription: "AradÄ±ÄŸÄ±nÄ±z sayfa bulunamadÄ±",
          statusCode: 404,
        };
      }
      
      return {
        title: `${item.title} - Site AdÄ±`,
        description: item.description || "VarsayÄ±lan aÃ§Ä±klama",
        canonicalUrl,
        ogTitle: item.title,
        ogDescription: item.description || "VarsayÄ±lan aÃ§Ä±klama",
        statusCode: 200,
      };
    }
  } catch (error) {
    console.error("SSR Meta Generation Error:", error);
  }
  
  // 404 iÃ§in varsayÄ±lan
  return {
    title: "Sayfa BulunamadÄ±",
    description: "AradÄ±ÄŸÄ±nÄ±z sayfa bulunamadÄ±",
    canonicalUrl,
    ogTitle: "Sayfa BulunamadÄ±",
    ogDescription: "AradÄ±ÄŸÄ±nÄ±z sayfa bulunamadÄ±",
    statusCode: 404,
  };
}
// HTML'i meta tag'ler ile render et
export async function renderHTMLWithMeta(
  req: Request,
  res: Response,
  templatePath: string
) {
  try {
    const url = req.originalUrl.split("?")[0]; // Query params'Ä± kaldÄ±r
    const meta = await generatePageMeta(url);
    
    // HTML template'ini oku
    let html = await fs.promises.readFile(templatePath, "utf-8");
    
    // URL'i parse et
    const parts = url.split("/").filter(Boolean);
    let renderedContent = "";
    let contentStatusCode = 200;
    
    // Admin ve statik sayfalar iÃ§in SSR'Ä± atla
    const skipSSR = url.startsWith("/admin") || 
                    url.startsWith("/api") ||
                    url === "/ara"; // Arama gibi client-side sayfalar
    
    if (!skipSSR) {
      if (parts.length === 0 || url === "/") {
        // Ana sayfa
        const result = await renderHomePage();
        renderedContent = result.html;
        contentStatusCode = result.statusCode;
      } else if (parts.length === 1) {
        // Detay sayfasÄ±: /:slug
        const result = await renderDetailPage(parts[0]);
        renderedContent = result.html;
        contentStatusCode = result.statusCode;
      }
    }
    
    // Placeholder'larÄ± deÄŸiÅŸtir
    html = html
      .replace(/\{\{TITLE\}\}/g, meta.title)
      .replace(/\{\{DESCRIPTION\}\}/g, meta.description)
      .replace(/\{\{CANONICAL_URL\}\}/g, meta.canonicalUrl)
      .replace(/\{\{OG_TITLE\}\}/g, meta.ogTitle)
      .replace(/\{\{OG_DESCRIPTION\}\}/g, meta.ogDescription);
    
    // Render edilmiÅŸ iÃ§eriÄŸi root div'e inject et
    if (renderedContent) {
      html = html.replace(
        '<div id="root"></div>',
        `<div id="root">${renderedContent}</div>`
      );
    }
    
    // Daha kÄ±sÄ±tlayÄ±cÄ± status code'u kullan
    const finalStatusCode = contentStatusCode !== 200 ? contentStatusCode : meta.statusCode;
    
    res.status(finalStatusCode).set({ "Content-Type": "text/html" }).send(html);
  } catch (error) {
    console.error("SSR Render Error:", error);
    res.status(500).send("Internal Server Error");
  }
}
ğŸ“ AdÄ±m 3: server/index.ts - SSR Route'larÄ± Ekle
Mevcut server/index.ts dosyana ÅŸunu ekle:

import express from "express";
import path from "path";
import { renderHTMLWithMeta } from "./ssr";
const app = express();
const PORT = process.env.PORT || 5000;
const NODE_ENV = process.env.NODE_ENV || "development";
// ... DiÄŸer middleware'ler (body-parser, session, vs.)
// API route'larÄ±
app.use("/api", apiRoutes); // Senin API route'larÄ±nÄ± buraya
// Production iÃ§in SSR
if (NODE_ENV === "production") {
  const distPath = path.resolve(__dirname, "../dist/public");
  const templatePath = path.join(distPath, "index.html");
  
  // Static dosyalar
  app.use(express.static(distPath));
  
  // TÃ¼m route'larÄ± SSR ile handle et
  app.get("*", async (req, res) => {
    await renderHTMLWithMeta(req, res, templatePath);
  });
} else {
  // Development iÃ§in normal Vite
  // (Mevcut Vite setup'Ä±n burada olmalÄ±)
}
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
ğŸ“ AdÄ±m 4: client/index.html - Placeholder'larÄ± Ekle
HTML template'ini ÅŸÃ¶yle dÃ¼zenle:

<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- SEO Meta Tags (SSR tarafÄ±ndan doldurulacak) -->
    <title>{{TITLE}}</title>
    <meta name="description" content="{{DESCRIPTION}}" />
    <link rel="canonical" href="{{CANONICAL_URL}}" />
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{OG_TITLE}}" />
    <meta property="og:description" content="{{OG_DESCRIPTION}}" />
    <meta property="og:url" content="{{CANONICAL_URL}}" />
    <meta property="og:type" content="website" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{OG_TITLE}}" />
    <meta name="twitter:description" content="{{OG_DESCRIPTION}}" />
  </head>
  <body>
    <!-- SSR tarafÄ±ndan iÃ§erik buraya gelecek -->
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
ğŸ“ AdÄ±m 5: .env DosyasÄ±na Ekle
NODE_ENV=production
BASE_URL=https://yoursite.com
ğŸš€ KullanÄ±m AdÄ±mlarÄ±
1. DosyalarÄ± YerleÅŸtir:
server/
  â”œâ”€â”€ render.ts       (Yeni oluÅŸtur)
  â”œâ”€â”€ ssr.ts          (Yeni oluÅŸtur)
  â””â”€â”€ index.ts        (GÃ¼ncelle)
client/
  â””â”€â”€ index.html      (GÃ¼ncelle - placeholder'lar ekle)
2. Storage MetodlarÄ±nÄ± Adapte Et:
render.ts iÃ§indeki storage metodlarÄ±nÄ± kendi veritabanÄ± yapÄ±na gÃ¶re deÄŸiÅŸtir:

// Ã–rnek:
const data = await storage.getHomeData();        // Kendi metodun
const item = await storage.getItemBySlug(slug);  // Kendi metodun
3. Route YapÄ±nÄ± DÃ¼zenle:
ssr.ts iÃ§inde URL parse mantÄ±ÄŸÄ±nÄ± kendi route yapÄ±na gÃ¶re ayarla:

// Ã–rnek route yapÄ±larÄ±:
// /:slug              â†’ Tek seviye
// /:category/:slug    â†’ Ä°ki seviye
// /:year/:month/:slug â†’ ÃœÃ§ seviye
4. Production Build Al:
npm run build
NODE_ENV=production node dist/index.js
5. Test Et:
# View Source kontrolÃ¼
curl http://localhost:5000/ | grep "<h1>"
# Meta tag kontrolÃ¼
curl http://localhost:5000/ | grep "<title>"
âœ… Checklist
 server/render.ts oluÅŸturuldu
 server/ssr.ts oluÅŸturuldu
 server/index.ts gÃ¼ncellendi (SSR route'larÄ± eklendi)
 client/index.html placeholder'lar eklendi
 Storage metodlarÄ± adapte edildi
 .env dosyasÄ±nda BASE_URL ayarlandÄ±
 Production build test edildi
 View Source'da iÃ§erik gÃ¶rÃ¼nÃ¼yor
ğŸ’¡ Ã–nemli Notlar
Development'ta SSR Ã§alÄ±ÅŸmaz - Sadece production build'de aktif
Static sayfalarÄ± skipSSR'a ekle - API, admin, vs. gibi
Her sayfa tipi iÃ§in ayrÄ± render fonksiyonu - ModÃ¼ler yapÄ±
404 durumunu handle et - SEO iÃ§in Ã¶nemli
Meta tag'leri dinamik oluÅŸtur - Her sayfa iÃ§in unique